{% extends "base.html" %}
{% load static %}
{% block title %}Dashboard | Raildrops{% endblock %}
{% block content %}
<div class="container mt-5">
    <div class="row mb-4">
        <div class="col-12 text-center">
            <h1 class="mb-1 h2">Min Dashboard</h1>
            <p class="text-muted mb-0" aria-label="Velkomstmelding">Hei, {{ user.first_name|default:user.username }}!</p>
            {% if user.profile_image %}
                <img src="{{ user.profile_image.url }}" alt="Profilbilde {{ user.username }}" class="rounded mt-2" style="max-height: 80px; object-fit: cover;">
            {% endif %}
            <div class="mt-3">
                <a href="{% url 'accounts:member-profile-edit' %}" class="btn btn-outline-primary" aria-label="Rediger din brukerprofil">
                    <i class="fa fa-user-edit" aria-hidden="true"></i> Rediger profil
                </a>
            </div>
        </div>
    </div>
    
    <!-- At-a-glance stats -->
    <div class="row mb-4 justify-content-center">
        <div class="col-md-4 mb-2">
            <div class="card text-center shadow-sm h-100">
                <div class="card-body">
                    <div class="display-5 fw-bold text-primary">{{ participations|default:0|length }}</div>
                    <div class="text-muted">Deltakelser</div>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-2">
            <div class="card text-center shadow-sm h-100">
                <div class="card-body">
                    <div class="display-5 fw-bold text-success">{{ wins|default:0 }}</div>
                    <div class="text-muted">Gevinster</div>
                </div>
            </div>
        </div>
    </div>
    <div class="row mb-4">
        <div class="col text-center">
            <a href="{% url 'accounts:member-profile' %}" class="btn btn-success btn-lg" aria-label="Vis din fulle profil">
                <i class="fa fa-user" aria-hidden="true"></i> Vis profil
            </a>
        </div>
    </div>
    
    <!-- Recent Participations -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="h4 mb-0">Dine giveaways</h2>
                {% if participations %}
                <a href="#" class="btn btn-sm btn-outline-secondary" aria-label="Se alle deltakelser">
                    <i class="fa fa-list" aria-hidden="true"></i> Se alle
                </a>
                {% endif %}
            </div>
            
            {% if participations %}
                <!-- Responsive Table with ARIA support -->
                <div class="table-responsive" role="region" aria-label="Oversikt over dine giveaway-deltakelser">
                    <table class="table table-striped align-middle">
                        <caption class="visually-hidden">Liste over dine giveaway-deltakelser</caption>
                        <thead>
                            <tr>
                                <th scope="col">Giveaway</th>
                                <th scope="col">Status</th>
                                <th scope="col">Deltatt</th>
                                <th scope="col">Vunnet</th>
                                <th scope="col"><span class="visually-hidden">Handlinger</span></th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for participation in participations %}
                            <tr>
                                <th scope="row">{{ participation.giveaway.title }}</th>
                                <td>
                                    {% if participation.giveaway.is_active %}
                                        <span class="badge bg-success" role="status">Aktiv</span>
                                    {% else %}
                                        <span class="badge bg-secondary" role="status">Avsluttet</span>
                                    {% endif %}
                                </td>
                                <td>{{ participation.created_at|date:"d.m.Y H:i" }}</td>
                                <td>
                                    {% if participation.is_winner %}
                                        <span class="badge bg-warning text-dark" role="status">Vunnet!</span>
                                    {% else %}
                                        <span aria-label="Ikke vunnet">-</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <a href="{% url 'giveaways:giveaway-detail' participation.giveaway.pk %}" 
                                       class="btn btn-outline-primary btn-sm"
                                       aria-label="Se detaljer for {{ participation.giveaway.title }}">
                                        <i class="fa fa-info-circle" aria-hidden="true"></i> Detaljer
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                <!-- Mobile Card View (visible on small screens only) -->
                <div class="d-md-none mt-3">
                    {% for participation in participations %}
                    <div class="card mb-3">
                        <div class="card-body">
                            <h3 class="card-title h5">{{ participation.giveaway.title }}</h3>
                            <div class="d-flex justify-content-between">
                                <div>
                                    {% if participation.giveaway.is_active %}
                                        <span class="badge bg-success">Aktiv</span>
                                    {% else %}
                                        <span class="badge bg-secondary">Avsluttet</span>
                                    {% endif %}
                                </div>
                                <div>
                                    {% if participation.is_winner %}
                                        <span class="badge bg-warning text-dark">Vunnet!</span>
                                    {% endif %}
                                </div>
                            </div>
                            <p class="card-text mt-2">
                                <small class="text-muted">Deltatt: {{ participation.created_at|date:"d.m.Y H:i" }}</small>
                            </p>
                            <a href="{% url 'giveaways:giveaway-detail' participation.giveaway.pk %}" 
                               class="btn btn-outline-primary btn-sm w-100">
                                <i class="fa fa-info-circle" aria-hidden="true"></i> Se detaljer
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="alert alert-info" role="alert">
                    <i class="fa fa-info-circle me-2" aria-hidden="true"></i>
                    Du har ikke deltatt i noen giveaways ennå. 
                    <a href="#" class="alert-link">Finn aktive giveaways</a> for å delta.
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
