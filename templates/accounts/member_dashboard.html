{% extends "base.html" %}
{% load static %}
{% load cache %}
{% load account_filters %}
{% block title %}Dashboard | Raildrops{% endblock %}
{% block content %}
<div class="container mt-5">
    {% include "includes/profile_header.html" with title="Min Dashboard" user=user %}
    
    <!-- At-a-glance stats using reusable component -->
    {% include "includes/stats_dashboard.html" with participations=participations wins=wins %}
    
    <div class="row mb-4">
        <div class="col text-center">
            <a href="{% url 'accounts:member-profile' %}" class="btn btn-success" aria-label="Vis din fulle profil">
                <i class="fa fa-user me-2" aria-hidden="true"></i> Vis profil
            </a>
        </div>
    </div>
    
    <!-- Recent Participations -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="h4 mb-0">Dine giveaways</h2>
                {% if participations %}
                <a href="#" class="btn btn-sm btn-outline-secondary" aria-label="Vis alle deltakelser">
                    <i class="fa fa-list me-1" aria-hidden="true"></i> Se alle
                </a>
                {% endif %}
            </div>
            
            {% cache 1800 user_participations_table user.id %}
            {% with headers="Giveaway,Status,Deltok,Vunnet,Handlinger"|split:"," %}
                {% if participations %}
                    <!-- Desktop Table View (hidden on small screens) -->
                    <div class="d-none d-md-block">
                        {% include "includes/responsive_table.html" with 
                            table_id="participations-table"
                            caption="Dine deltakelser i giveaways"
                            headers=headers
                            rows=participations
                            empty_message="Du har ikke deltatt i noen giveaways enn책. Finn aktive giveaways for 책 delta."
                            row_template="includes/participation_row.html"
                        %}
                    </div>
                    
                    <!-- Mobile Card View (visible on small screens only) -->
                    <div class="d-md-none mt-3">
                        {% for participation in participations %}
                            {% include "includes/participation_row_card.html" with row=participation %}
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="alert alert-info" role="alert">
                        <i class="fa fa-info-circle me-2" aria-hidden="true"></i>
                        Du har ikke deltatt i noen giveaways enn책. Finn aktive giveaways for 책 delta.
                    </div>
                {% endif %}
            {% endwith %}
            {% endcache %}
        </div>
    </div>
    
    <!-- Nearby Giveaways Section -->
    <div class="row">
        <div class="col-12">
            {% include "includes/nearby_giveaways.html" with 
                nearby_giveaways=nearby_giveaways 
                user_location=user.city
            %}
        </div>
    </div>
</div>
{% endblock %}